Component DateConv {
  data ds: int[];
  data ws: int[];

  relation Days(xs: int[], ys: int[]) {
    foreach (x, y) in (xs, ys) {
      y = 7 * x
    }
  }

  always Days(ds, ws);
}

Component Sum {
  data ds: int[];
  data su: int[];

  relation Days(xs: int[], ys: int[]) {
    foreach (x, y) in (xs, ys) {
      y = prev(y, 0) + x
    }
  }

  always Days(ds, ws);
}

Component CondFormat {

  data pos : int;
  data neg : int;
  data vals : int[];
  data colors: int[];

  relation Colored(p: int, n: int, vs: int[], cs: int[]) {
    foreach (v, c) in (vs, cs) {
      (v >= 0 ==> c = p) &&
      (v <  0 ==> c = n)
    }
  }

  always Colored(pos, neg, vals, colors);
}

Component AltColor {
  data evenColor : int;
  data oddColor : int;
  data rows : int[];

  relation Alternating(e: int, o: int, cs: int[]) {
    foreach (c) with idx in (cs){
      ((idx % 2) = 0 ==> c = e) && 
      ((idx % 2) = 1 ==> c = o)
    }
  }

  always Alternating(evenColor, oddColor, rows);
}

Component Either {
  data a : int;
  data b: int;
  data vals : int[];

  relation allEither(l: int, r: int, cs: int[]) {
    foreach (c) in (cs){
      (c = l || c = r)
    }
  }

  always allEither(a, b, vals);
}


Component Main {
  data weeks: int[];
  data days: int[];
  data sums: int[];

  data fontColors: int[];
  data bkgColors: int[];

  data oddColor: int;
  data evenColor: int;
  data positiveColor: int;
  data negativeColor: int;

  using DateConv(days, weeks);
  using Sum(days, sums);

  
  using CondFormat(positiveColor, negativeColor, weeks, fontColors);
  using Either(positiveColor, negativeColor, fontColors);
  using AltColor(evenColor, oddColor, bkgColors);
  using Either(oddColor, evenColor, bkgColors);

  
  
  
  procedure editDaily() {
    let i: int;
    let val: int;
    let sprev: int;
    for (d: int, w: int, fcolor: int, s: int) with idx in (days, weeks, fontColors, sums) {
      if (idx == i) {
        d = val;
        w = 7 * d;
        if (d >= 0) {
          fcolor = positiveColor;
        } else {
          fcolor = negativeColor;
        }
        if (idx == 0) {
          s = d;
        } else {
          s = d + sprev;
        }
      }
    }

  }
  

  procedure adjustCOLA() {
    let cola: int;
    let sprev: int;
    for (d: int, w: int, s: int) in (days, weeks, sums) {
      if (d < 0) {
        d = d * cola;
        w = 7 * d;
        if (idx == 0) {
          s = d;
        } else {
          s = d + sprev;
        }
      }
    }
  }


  procedure evenBkg() {
    let x : int;
    evenColor = x;
    oddColor = oddColor;
    for (c: int) with idx in (bkgColors) {
      if (idx % 2 == 1) {
        c = oddColor;
      } else {
        c = evenColor;
      }
    }
  }



}

