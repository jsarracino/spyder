Component Shared {
  data l: int[];
  data r: int[];
  data m: int[];
  data s: int[];

  relation Mid(ls: int[], rs: int[], ms: int[]) {
    foreach (a, b, c) in (ls, rs, ms) {
      c = (a + b) / 2
    }
  }

  relation Sum(ls: int[], rs: int[], ss: int[]) {
    foreach (a, b, c) in (ls, rs, ss) {
      c = a + b
    }
  }

  always Mid(l, r, m);
  always Sum(l, r, s);
  
}

Component CondFormat {

  data pos : int;
  data neg : int;
  data vals : int[];
  data colors: int[];

  relation Colored(p: int, n: int, vs: int[], cs: int[]) {
    foreach (v, c) in (vs, cs) {
      (v >= 0 ==> c = p) &&
      (v <  0 ==> c = n)
    }
  }

  always Colored(pos, neg, vals, colors);
}

Component Main {
  data me: int[];
  data them: int[];
  data mid: int[];
  data sum: int[];

  data posColor : int;
  data negColor : int;
  data colors : int[];

  using Shared(me, them, mid, sum);
  using CondFormat(posColor, negColor, sum, colors);

  procedure addRowMeThem() {
    
    let val: int;
    let val2: int;
    let i: int;
    for (x: int, t: int) with idx in (me, them) {
      if (idx == i) {
        x = val;
        t = val2;
      }
    }
  }

  procedure addRowMeSum() {
    
    let val: int;
    let val2: int;
    let i: int;
    for (x: int, t: int) with idx in (me, sum) {
      if (idx == i) {
        x = val;
        t = val2;
      }
    }
  }

  procedure adjustMeEntry() {
    let val: int;
    let i: int;
    for (x: int, t: int) with idx in (me, sum) {
      if (idx == i) {
        x = val;
        t = t;
      }
    }
  }

  procedure adjustThemEntry() {

    let val: int;
    let i: int;
    for (x: int, t: int) with idx in (them, sum) {
      if (idx == i) {
        x = val;
        t = t;
      }
    }
  }


}